<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="estilo/style-registro.css">
    <link rel="stylesheet" href="estilo/menuside.css">
    <title>Vital Age</title>
</head>
<body>

<div class="container">
    <div class="box_menu">
        <div class="registro">
            <div class="card-registro">
                <h1>Registros</h1>
                <div id="heart-rate-data">
                    <ol id="heart-rate-list">
                        <!-- A lista de batimentos cardíacos será exibida aqui -->
                    </ol>
                </div>
            </div>
        </div>
        <div class="header-right">
            <p id="user-greeting">Olá, <span id="user-name"></span></p>
            <button class="Btn" id="logout-button">
                <div class="sign">
                    <svg viewBox="0 0 512 512">
                        <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"></path>
                    </svg>
                </div>
                <div class="text-logout">Logout</div>
            </button>
        </div>
        <div>
            <input type="checkbox" id="check">
            <div class="menu-icon">
                <label for="check">
                    <i class="fas fa-bars"></i>
                </label>
            </div>
            <div class="sidebar_menu">
                <div class="sidebar_titulo">
                    <a href="#">Painel de Controle</a>
                </div>
                <div class="btn_close">
                    <label for="check">
                        <i class="fas fa-times"></i>
                    </label>
                </div>
                <nav class="menu">
                    <ul>
                        <li>
                            <i class="fas fa-house"></i>
                            <a href="./home.html">Home</a>
                        </li>
                        <li>
                            <i class="fas fa-person-cane"></i>
                            <a href="./perfil.html">Perfil</a>
                        </li>
                        <li>
                            <i class="fas fa-table-list"></i>
                            <a href="./registro.html">Registros</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Importando as bibliotecas do Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-database.js"></script>

<script>
    var firebaseConfig = {
        apiKey: "AIzaSyBb7OoZjFjfJlbOQvtpPH7hGDpxY5giDNI",
        authDomain: "vitalage-site.firebaseapp.com",
        projectId: "vitalage-site",
        storageBucket: "vitalage-site.appspot.com",
        messagingSenderId: "9825977049",
        appId: "1:9825977049:web:14cc2655ba499336acb4c8"
    };

    // Inicializando o app do Firebase
    firebase.initializeApp(firebaseConfig);

    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            var uid = user.uid;
            var var_list = document.getElementById("heart-rate-list");
            var batimentosRef = firebase.database().ref('users/' + uid + '/heartbeats');

            batimentosRef.on('child_added', function(snapshot) {
                var batimentoData = snapshot.val();
                var batimento = batimentoData.bpm;
                var timestamp = batimentoData.timestamp;

                var listItem = document.createElement("li");
                listItem.textContent = "Batimento: " + batimento + ", Data: " + formatDate(timestamp);
                var_list.appendChild(listItem);
            });

            var firestore = firebase.firestore();
            var usuarioRef = firestore.collection('usuarios').doc(uid);

            usuarioRef.get().then(function(doc) {
                if (doc.exists) {
                    var usuario = doc.data().usuario;
                    document.getElementById('user-name').textContent = usuario;
                } else {
                    console.log("O documento não foi encontrado!");
                }
            }).catch(function(error) {
                console.log("Erro ao acessar o documento:", error);
            });

            document.getElementById('logout-button').addEventListener('click', function() {
                firebase.auth().signOut()
                    .then(function() {
                        console.log('Logout realizado com sucesso!');
                        window.location.href = '../index.html';
                    })
                    .catch(function(error) {
                        console.error('Erro ao realizar logout:', error);
                    });
            });
        } else {
            console.log('Usuário não autenticado. Redirecionando para a página de login...');
            window.location.href = '../index.html';
        }
    });

    function formatDate(timestamp) {
        var date = new Date(timestamp * 1000);
        var options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', timeZoneName: 'short' };
        return date.toLocaleDateString('pt-BR', options);
    }
</script>

</body>
</html>
